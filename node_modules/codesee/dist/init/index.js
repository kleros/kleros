"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const chalk_1 = __importDefault(require("chalk"));
const environments_1 = require("./environments");
const create_react_app_1 = require("./create-react-app");
exports.default = register;
function register(program) {
    program
        .command("init")
        .description("install CodeSee into your codebase")
        .action(init);
}
async function init() {
    try {
        await runInit();
    }
    catch (err) {
        console.log(`\n${chalk_1.default.red(`Error: ${err.message}`)}`);
        process.exit(1);
    }
}
async function runInit() {
    console.log(`\nInstalling CodeSee in ${chalk_1.default.green(process.cwd())}.`);
    console.log("\nAutomatically detecting your environment...");
    const environment = await environments_1.detectEnvironment();
    switch (environment) {
        case environments_1.Environments.CreateReactAppV4:
            console.log(`Detected ${chalk_1.default.green("Create React App v4.x")}.`);
            await create_react_app_1.initCreateReactApp(4);
            break;
        case environments_1.Environments.CreateReactAppV3:
            console.log(`Detected ${chalk_1.default.green("Create React App v3.x")}.`);
            await create_react_app_1.initCreateReactApp(3);
            break;
        case environments_1.Environments.CreateReactAppV2:
            console.log(`Detected ${chalk_1.default.green("Create React App v2.x")}.`);
            await create_react_app_1.initCreateReactApp(2);
            break;
        case environments_1.Environments.CreateReactAppV1:
            throw new Error("We don't support installing CodeSee on Create React App v1.x environments. Please upgrade to v2+ to use CodeSee.");
        case environments_1.Environments.Unknown:
            throw new Error("We can't automatically determine the environment.\nCheck out https://docs.codesee.io to find out how to install CodeSee into your app.");
    }
}
